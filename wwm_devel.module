<?php

use Drupal\Core\Form\FormStateInterface;
use Drupal\Core\Url;

/**
 * Implements hook_form_FORM_ID_alter().
 */
function wwm_devel_form_system_site_maintenance_mode_alter(&$form, FormStateInterface $form_state, $form_id) {
  $config = \Drupal::service('config.factory')->get('wwm_devel.settings');
  $permissions = \Drupal::service('user.permissions')->getPermissions();
  $permission_label = $permissions['access site in maintenance mode']['title'];

  $form['wwm_devel'] = [
    '#type' => 'fieldset',
    '#collapsible' => TRUE,
    '#title' => t('WWM Devel Settings'),
  ];
  $form['wwm_devel']['wwm_devel_maintenance_mode'] = [
    '#type' => 'checkbox',
    '#title' => t('Put site into maintenance mode'),
    '#default_value' => $config->get('maintenance_mode'),
    '#description' => t('Visitors will only see the maintenance mode message. Only users with the "@permission-label" <a href=":permissions-url">permission</a> will be able to access the site. Authorized users can log in directly via the <a href=":user-login">user login</a> page.', ['@permission-label' => $permission_label, ':permissions-url' => Url::fromRoute('user.admin_permissions')->toString(), ':user-login' => Url::fromRoute('user.login')->toString()]),
  ];

  $form['#submit'][] = 'wwm_devel_system_site_maintenance_mode_submit';
}

/**
 * Form submission handler for system_site_maintenance_mode form.
 */
function wwm_devel_system_site_maintenance_mode_submit($form, FormStateInterface $form_state) {
  $config = \Drupal::service('config.factory')->getEditable('wwm_devel.settings');
  $config->set('maintenance_mode', $form_state->getValue('wwm_devel_maintenance_mode'))
    ->save();
}
